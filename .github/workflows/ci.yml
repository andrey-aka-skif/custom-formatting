# yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json

name: Continuous Integration

on:
    push:
        branches: ['**']
    workflow_call: {}
    workflow_dispatch:

jobs:
    run-ci:
        runs-on: ubuntu-latest

        steps:
          - name: ğŸ›’ Checkout
            uses: actions/checkout@v4

          - name: âœ¨ Setup Node.js
            uses: actions/setup-node@v4
            with:
                node-version: '20'
                cache: 'npm'

          - name: ğŸ“¦ Install dependencies
            run: npm ci

          - name: ğŸ“ Lint
            run: npm run lint

          - name: ğŸ—ï¸ Build and cache
            id: cache-build
            uses: actions/cache@v4
            with:
              path: dist/
              key: build-${{ github.sha }}-${{ hashFiles('src/**', 'package.json') }}
              restore-keys: |
                build-

          - name: ğŸ› ï¸ Build if cache missed
            if: steps.cache-build.outputs.cache-hit != 'true'
            run: npm run build

          - name: ğŸ§ª Run tests
            run: npm test
